{% extends "base.html" %}

{% block title %}Личный кабинет — Бенчмарк Клуб{% endblock %}

{% block content %}
  <section class="grid">
    <h1>Привет, {{ current_user.display_name }}!</h1>
    <div class="cards-grid two-cols">
      <article class="card highlight">
        <h2>Ваш статус</h2>
        <p class="status-title">{{ profile.title }}</p>
        <p><strong>{{ profile.points }}</strong> очков сообщества</p>
        <ul class="stat-list">
          <li>Сборок создано: {{ profile.total_builds }}</li>
          <li>Опубликовано в каталоге: {{ profile.published_builds }}</li>
          <li>Подписчиков: {{ profile.followers }}</li>
          <li>Подписок: {{ profile.following }}</li>
        </ul>
        <a class="btn" href="{{ url_for('builds.create') }}">Создать сборку</a>
      </article>
      <article class="card">
        <h2>Последние достижения</h2>
        <ul class="achievement-list">
          {% for item in achievements %}
            <li>
              <strong>{{ item.achievement.name }}</strong>
              <span>{{ item.achievement.description }}</span>
            </li>
          {% else %}
            <li>Вы еще не заработали достижений — начните с первой публикации!</li>
          {% endfor %}
        </ul>
      </article>
    </div>
  </section>

  <section class="grid">
    <h2>Мои последние сборки</h2>
    <div class="cards-grid">
      {% for build in recent_builds %}
        <article class="card">
          {% if build.cover_image %}
            <div class="card__media">
              <img src="{{ url_for('media.uploaded_file', filename=build.cover_image) }}" alt="Обложка {{ build.title }}">
            </div>
          {% endif %}
          <h3><a href="{{ url_for('builds.detail', build_id=build.id) }}">{{ build.title }}</a></h3>
          <p>{{ build.description|truncate(120) }}</p>
          <p class="card__meta">
            {{ 'Опубликовано' if build.is_published else 'Черновик' }} · {{ build.updated_at.strftime('%d.%m.%Y') if build.updated_at else build.created_at.strftime('%d.%m.%Y') }}
            {% if build.is_anonymous %} · Анонимно{% endif %}
          </p>
        </article>
      {% else %}
        <p>Еще нет сборок. Создайте первую и поделитесь с комьюнити!</p>
      {% endfor %}
    </div>
  </section>

  <section class="grid">
    <h2>Недавние тесты</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Сборка</th>
          <th>Бенчмарк</th>
          <th>Результат</th>
          <th>Дата</th>
        </tr>
      </thead>
      <tbody>
        {% for item in benchmarks %}
          <tr>
            <td>{{ item.build_name }}</td>
            <td>{{ item.benchmark_name }}</td>
            <td>{{ item.score }}</td>
            <td>
              {{ item.recorded_at.strftime('%d.%m.%Y') }}
              {% if item.is_anonymous %}<span class="badge badge-muted">Анонимно</span>{% endif %}
              {% if item.screenshot_path %}
                <a href="{{ url_for('media.uploaded_file', filename=item.screenshot_path) }}" target="_blank" rel="noopener">Скриншот</a>
              {% endif %}
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="4">Еще нет сохраненных бенчмарков.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
{% endblock %}

